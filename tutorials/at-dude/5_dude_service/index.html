<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script>

  <link rel="stylesheet" href="https://dev3.atsign.wtf/main.e885e309b310ba63705c11ca438e84adba8dcd3b64e2c38fb482211c1a1dd2a852f4a6a570f34a1a03c4decd0fdd5a32b827a751a403b225c24eb5df93755881.css" integrity="sha512-6IXjCbMQumNwXBHKQ46ErbqNzTtk4sOPtIIhHBod0qhS9KalcPNKGgPE3s0P3VoyuCenUaQDsiXCTrXfk3VYgQ==" crossorigin="anonymous">
<noscript><style>img.lazyload { display: none; }</style></noscript>
  <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <title>Dude Service - atPlatform</title>
<meta name="description" content="Documentation
">
<link rel="canonical" href="https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/">
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Dude Service">
<meta property="og:description" content="Documentation
">
<meta property="og:url" content="https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/">
<meta property="og:site_name" content="atPlatform">

  
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="atsigncompany">
<meta name="twitter:creator" content="atsigncompany">
<meta name="twitter:title" content="Dude Service">
<meta name="twitter:description" content="Documentation
">
<meta name="twitter:card" content="summary">
    <meta name="twitter:image:alt" content="Dude Service">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Person",
        "@id": "https://dev3.atsign.wtf/#/schema/person/1",
      "name": "",
      "url": "https://dev3.atsign.wtf/",
      "sameAs": [
        ],
      "image": {
          "@type": "ImageObject",
          "@id": "https://dev3.atsign.wtf/#/schema/image/1",
          "url": "https://dev3.atsign.wtf/\u003cnil\u003e",
          "width":  null ,
          "height":  null ,
          "caption": ""
        }
      },
    {
      "@type": "WebSite",
      "@id": "https://dev3.atsign.wtf/#/schema/website/1",
      "url": "https://dev3.atsign.wtf/",
      "name": "atPlatform",
      "description": "The atPlatform is the fastest and easiest way to develop peer-to-peer, end-to-end encrypted apps.\n",
      "publisher": {
          "@id": "https://dev3.atsign.wtf/#/schema/person/1"
        }
      },
    {
      "@type": "WebPage",
      "@id": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/",
      "url": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/",
      "name": "Dude Service",
      "description": "Documentation\n",
      "isPartOf": {
        "@id": "https://dev3.atsign.wtf/#/schema/website/1"
      },
      "about": {
          "@id": "https://dev3.atsign.wtf/#/schema/person/1"
        },
      "datePublished": "0001-01-01T00:00:00CET",
      "dateModified": "0001-01-01T00:00:00CET",
      "breadcrumb": {
        "@id": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/#/schema/breadcrumb/1"
      },
      "primaryImageOfPage": {
        "@id": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/#/schema/image/2"
      },
      "inLanguage": "",
      "potentialAction": [{
        "@type": "ReadAction", "target": ["https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/"]
      }]
    },
    {
      "@type": "BreadcrumbList",
      "@id": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/#/schema/breadcrumb/1",
      "name": "Breadcrumbs",
      "itemListElement": [{
        "@type": "ListItem",
        "position":  1 ,
        "item": {
          "@type": "WebPage",
          "@id": "https://dev3.atsign.wtf/",
          "url": "https://dev3.atsign.wtf/",
          "name": "Home"
          }
        },{
        "@type": "ListItem",
        "position":  2 ,
        "item": {
          "@type": "WebPage",
          "@id": "https://dev3.atsign.wtf/tutorials/",
          "url": "https://dev3.atsign.wtf/tutorials/",
          "name": "Tutorials"
          }
        },{
        "@type": "ListItem",
        "position":  3 ,
        "item": {
          "@type": "WebPage",
          "@id": "https://dev3.atsign.wtf/tutorials/at-dude/",
          "url": "https://dev3.atsign.wtf/tutorials/at-dude/",
          "name": "At Dude"
          }
        },{
        "@type": "ListItem",
        "position":  4 ,
        "item": {
          "@id": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/"
          }
        }]
    },

    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "ImageObject",
          "@id": "https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/#/schema/image/2",
          "url":  null ,
          "contentUrl":  null ,
          "caption": "Dude Service"
        }
      ]
    }

  ]
}
</script>

  <meta name="theme-color" content="#fff">
<link rel="apple-touch-icon" sizes="180x180" href="https://dev3.atsign.wtf/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://dev3.atsign.wtf/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://dev3.atsign.wtf/favicon-16x16.png">
<link rel="manifest" crossorigin="use-credentials" href="https://dev3.atsign.wtf/site.webmanifest">

</head>
  <body class="tutorials single">
    <div class="header-bar"></div>

<header class="navbar navbar-expand-md navbar-light doks-navbar">
  <nav class="container-fluid flex-wrap flex-md-nowrap" aria-label="Main navigation">
    <a class="navbar-brand p-0 me-auto" href="https://dev3.atsign.wtf/" aria-label="atPlatform">
      <img class="toggle-light" src="https://i.imgur.com/se4lyAK.png" width="320em" /> 
      <img class="toggle-dark" src="https://i.imgur.com/EjdCMan.png" width="320em" />
    </a>

    <button class="btn btn-menu d-block d-md-none order-5" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasDoks" aria-controls="offcanvasDoks" aria-label="Open main menu">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>

    <div class="offcanvas offcanvas-end border-0 py-md-1" tabindex="-1" id="offcanvasDoks" data-bs-backdrop="true" aria-labelledby="offcanvasDoksLabel">
      <div class="header-bar d-md-none"></div>
      <div class="offcanvas-header d-md-none">
        <h2 class="h5 offcanvas-title ps-2" id="offcanvasDoksLabel"><a class="text-dark" href="https://dev3.atsign.wtf/">atPlatform</a></h2>
        <button type="button" class="btn-close text-reset me-2" data-bs-dismiss="offcanvas" aria-label="Close main menu"></button>
      </div>
      <div class="offcanvas-body px-4">
        <h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3>
        <ul class="nav flex-column flex-md-row ms-md-n3">
              <li class="nav-item">
                <a class="nav-link ps-0 py-1" href="https://dev3.atsign.wtf/">Home</a>
              </li>
            
          
              <li class="nav-item">
                <a class="nav-link ps-0 py-1" href="https://dev3.atsign.wtf/start/">Get Started</a>
              </li>
            
          
              <li class="nav-item">
                <a class="nav-link ps-0 py-1" href="https://my.atsign.com/go">Get an atSign</a>
              </li>
            
          </ul>
        <hr class="text-black-50 my-4 d-md-none">
        <h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3>
        <ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2">
          </ul>
      </div>
    </div>
    <button id="mode" class="btn btn-link order-md-1" type="button" aria-label="Toggle user interface mode">
      <span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
      <span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
    </button>
    <a target="_blank" href="https://atsign.com">atsign.com</a>
    
    <div class="dropdown order-md-2">
      <button class="btn btn-doks-light dropdown-toggle" id="doks-languages" data-bs-toggle="dropdown" aria-expanded="false" data-bs-display="static">
        EN
        <span class="dropdown-caret"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg></span>
      </button>
      <ul class="dropdown-menu dropdown-menu-end shadow rounded border-0" aria-labelledby="doks-languages">

        <li><a class="dropdown-item current" aria-current="true" href="https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/">English</a></li>

        <li><hr class="dropdown-divider"></li>

      
      </ul>
    </div>
    </nav>
</header>

<nav class="doks-subnavbar py-2 sticky-lg-top d-lg-none" aria-label="Secondary navigation">
  <div class="container-fluid d-flex align-items-md-center">
    <span class="navbar-text ms-0">Tutorials</span>
    <button class="btn doks-sidebar-toggle d-lg-none ms-auto order-3 collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#doks-docs-nav" aria-controls="doks-docs-nav" aria-expanded="false" aria-label="Toggle documentation navigation">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"></polyline><polyline points="7 6 12 11 17 6"></polyline></svg>
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"></polyline><polyline points="17 18 12 13 7 18"></polyline></svg>
    </button>
  </div>
</nav>

<div class="container-fluid">
  <aside class="doks-sidebar">
    <nav id="doks-docs-nav" class="collapse d-lg-none" aria-label="Tertiary navigation">
      
<ul class="list-unstyled collapsible-sidebar">
  
</ul>

    </nav>
  </aside>
</div>

    <div class="wrap container-fluid" role="document">
      <div class="content">
          
  
  
  <link rel="stylesheet" href="https://dev3.atsign.wtf/main.1240b01203c071e6914231f83ccc4609bc467dfeef115decb9124a89725997ef944be0e7a0b22034aa029b1413f573451fe0cf70065ac8c2365f327701935c80.css" integrity="sha512-EkCwEgPAceaRQjH4PMxGCbxGff7vEV3suRJKiXJZl&#43;&#43;US&#43;DnoLIgNKoCmxQT9XNFH&#43;DPcAZayMI2XzJ3AZNcgA==" crossorigin="anonymous">
  <div class="codelab">
  <div class="codelab-nav-buttons">
    <a class="codelab-arrow-back text-decoration-none" href="https://dev3.atsign.wtf/tutorials" id="arrow-back">← Exit Codelab</a>
  </div>
  






















































































<div class="codelab-timer">
  
  ⏱
  
  11 mins remaining
  
</div>

  <div class="codelab-title">
    
    <h1>atDude Tutorial</h1>
    
    
    <p class="lead">Learn how the atDude app works</p>
    
  </div>
  
<div class="codelab-drawer">
  <h3 class="codelab-nav-title">Steps <span>in this module</span></h3>
  <div class="codelab-steps">
    <ol>
          
      <li  completed>
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/1_introduction/">
          <span class="codelab-step">
            <span>Introduction</span>
          </span>
        </a>
      </li>
        
      <li  completed>
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/2_model/">
          <span class="codelab-step">
            <span>Models</span>
          </span>
        </a>
      </li>
        
      <li  completed>
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/3_navigation_service/">
          <span class="codelab-step">
            <span>Navigation Service</span>
          </span>
        </a>
      </li>
        
      <li  completed>
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/4_local_notification_services/">
          <span class="codelab-step">
            <span>Local Notification Service</span>
          </span>
        </a>
      </li>
          
      <li selected >
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/5_dude_service/">
          <span class="codelab-step">
            <span>Dude Service</span>
          </span>
        </a>
      </li>
        
      <li  >
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/6_controller/">
          <span class="codelab-step">
            <span>Controller</span>
          </span>
        </a>
      </li>
        
      <li  >
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/7_onboarding/">
          <span class="codelab-step">
            <span>Onboarding</span>
          </span>
        </a>
      </li>
        
      <li  >
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/8_send_dude_srcreen/">
          <span class="codelab-step">
            <span>Send Dude Screen</span>
          </span>
        </a>
      </li>
        
      <li  >
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/9_history_screen/">
          <span class="codelab-step">
            <span>History Screen</span>
          </span>
        </a>
      </li>
        
      <li  >
        <a href="https://dev3.atsign.wtf/tutorials/at-dude/10_profile_screen/">
          <span class="codelab-step">
            <span>Profile Screen</span>
          </span>
        </a>
      </li>
      
    </ol>
  </div>
</div>

  <div class="codelab-body">
    <div class="codelab-steps">
      <div class="codelab-step">
        <div class="codelab-instructions">
          <h2 class="codelab-step-title">Dude Service</h2>
          <table>
<thead>
<tr>
<th>TOC</th>
</tr>
</thead>
</table>
<p>| <a href="#dudeservice">Dude Service</a> |
| <a href="#imports">Dude Service Imports</a> |
| <a href="#properties-of-dudeservice">Dude Service Properties</a> |
| <a href="#localnotificationservice">Local Notification</a> |
| <a href="#imports-1">Local Notification imports</a> |
| <a href="#properties-of-localnotificationservice">Properties of LocalNotificationService</a> |</p>
<p>They are three service classes in the dude app, they are <code>NavigationServices()</code>, <code>DudeServices()</code> and <code>LocalNotificationServices()</code>. In this code lab we will explore the properties of these classes.</p>
<h4 id="dudeservice">DudeService <a href="#dudeservice" class="anchor" aria-hidden="true">#</a></h4>
<p>This class is a singleton that makes all the network calls to the atPlatform.</p>
<h5 id="imports">Imports <a href="#imports" class="anchor" aria-hidden="true">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dart" data-lang="Dart"><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;dart:async&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;dart:convert&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;dart:typed_data&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:flutter/material.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_app_flutter/at_app_flutter.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_client/src/service/notification_service.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_client_mobile/at_client_mobile.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_commons/at_commons.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_contact/at_contact.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_contacts_flutter/services/contact_service.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;package:at_utils/at_utils.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;../models/dude_model.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;../models/profile_model.dart&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="s1">&#39;local_notification_service.dart&#39;</span><span class="p">;</span>
</span></span></code></pre></div><p>All the packages that starts with <code>at_</code> are packages that allows us to interact with the atPlatform.</p>
<dl>
<dt>at_app_flutter</dt>
<dd>A library that help developers build flutter applications on the atPlatform.</dd>
<dt>at_client</dt>
<dd>The at_client library is the non-platform specific Client SDK which provides the essential methods for building an app using the atProtocol.</dd>
<dt>at_client_mobile</dt>
<dd>A Flutter extension to the at_client library which adds support for mobile, desktop and IoT devices.</dd>
<dt>at_commons</dt>
<dd>A library of Dart and Flutter utility classes that are used across other components of the @‎platform.</dd>
<dt>at_contacts:</dt>
<dd>A Dart library for managing contact data that developers can use for their applications.</dd>
<dt>at_contacts_flutter</dt>
<dd>A Flutter plugin project to provide ease of managing contacts for an @‎sign using @‎platform.</dd>
<dt>at_utils</dt>
<dd>A Dart library that contains various utility classes such as atSign, atmetadata, configuration, and logger.</dd>
</dl>
<p>We discussed the dude and profile model in the previous codelab.</p>
<h5 id="properties-of-dudeservice">Properties of DudeService <a href="#properties-of-dudeservice" class="anchor" aria-hidden="true">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">DudeService</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="kd">final</span> <span class="n">DudeService</span> <span class="n">_singleton</span> <span class="o">=</span> <span class="n">DudeService</span><span class="p">.</span><span class="n">_internal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">DudeService</span><span class="p">.</span><span class="n">_internal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">factory</span> <span class="n">DudeService</span><span class="p">.</span><span class="n">getInstance</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">_singleton</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">final</span> <span class="n">AtSignLogger</span> <span class="n">_logger</span> <span class="o">=</span> <span class="n">AtSignLogger</span><span class="p">(</span><span class="n">AtEnv</span><span class="p">.</span><span class="n">appNamespace</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">AtClient</span><span class="o">?</span> <span class="n">atClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">AtClientService</span><span class="o">?</span> <span class="n">atClientService</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="n">atClientManager</span> <span class="o">=</span> <span class="n">AtClientManager</span><span class="p">.</span><span class="n">getInstance</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="kd">var</span> <span class="n">contactService</span> <span class="o">=</span> <span class="n">ContactService</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Receives all dudes sent to the current atsign.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">DudeModel</span><span class="o">&gt;&gt;</span> <span class="n">getDudes</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Subscribes to the stream of data being sent to the current atsign.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kt">void</span> <span class="n">monitorNotifications</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Fetch the current atsign contacts.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AtContact</span><span class="o">&gt;?&gt;</span> <span class="n">getContactList</span><span class="p">()</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Fetch the current atsign profile image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">Uint8List</span><span class="o">?&gt;</span> <span class="n">getCurrentAtsignProfileImage</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Fetch details for the current atsign
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">dynamic</span><span class="o">&gt;</span> <span class="n">getCurrentAtsignContactDetails</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Get the profile stats for the current atsign
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">ProfileModel</span><span class="o">&gt;</span> <span class="n">getProfile</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Save senders atsign to the current atsign local secondary.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">&gt;</span> <span class="n">putSenderAtsign</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="n">required</span> <span class="kt">String</span> <span class="n">senderAtsign</span><span class="p">,</span> <span class="n">required</span> <span class="kt">String</span> <span class="n">receiverAtsign</span><span class="p">})</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Get sender atsign saved in the current atsign remote secondary.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;&gt;</span> <span class="n">getSenderAtsigns</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">/// Delete dude sent to the current atsign.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">deleteDude</span><span class="p">(</span><span class="n">DudeModel</span> <span class="n">dude</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{...}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Line 2 - 6 creates a singleton pattern. Every time <code>DudeService.getInstance()</code> is called it will always return the same object. You can read more about it in on <a href="https://stackoverflow.com/questions/65868841/why-must-the-internal-be-called-in-the-class">stackoverflow</a>.</p>
<p>The <code>AtSignLogger</code> in line 9 is used to generate server logs. It also helps to classify logs into subclasses live severe, info and warning based on importance.</p>
<p>Lines 11 to 14 creates instances of <code>AtClient()</code>, <code>AtClientService()</code>, <code>AtClientManager()</code> and <code>ContactService()</code>.</p>
<dl>
<dt>AtClient</dt>
<dd>AtClient should be used to perform Create, Read, Update or Delete (CRUD) operations on the secondary server.</dd>
<dt>AtClientService</dt>
<dd>Class that manages your atsigns.</dd>
<dt>AtClientManager</dt>
<dd>Factory class responsible for giving the instances of AtClient and other services for a given atSign.</dd>
</dl>
<h5 id="dudeservice-methods">DudeService Methods <a href="#dudeservice-methods" class="anchor" aria-hidden="true">#</a></h5>
<p>We&rsquo;ll now discuss the network calls that are made to the atPlatform to perform various CRUD operation.</p>
<h6 id="putdude-method">putDude Method <a href="#putdude-method" class="anchor" aria-hidden="true">#</a></h6>
<p>This method saves the <code>DudeModel</code> and <code>ProfileModel</code> on the atPlatform.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="c1">/// Saves Dude to the receiver&#39;s remote secondary and stats to the sender&#39;s local secondary.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">dude</span><span class="p">.</span><span class="n">saveSender</span><span class="p">(</span><span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="n">getCurrentAtSign</span><span class="p">()</span><span class="o">!</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">dude</span><span class="p">.</span><span class="n">saveReceiver</span><span class="p">(</span><span class="n">contactAtsign</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">dude</span><span class="p">.</span><span class="n">saveId</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Line 4 instantiates <code>isCompleted</code> to false. This is to display a <code>CircularProgressIndicator</code> on the UI while this method is being executed.</p>
<p>Line 5 saves the currentAtsign or signed in user to the <code>DudeModel.receiver</code> property.</p>
<p>Line 6 saves the <code>contactAtsign</code> to the <code>DudeModel.receiver</code> property. The <code>contactAtsign</code> is the atsign that was selected as the receiver in the UI.</p>
<p>line 7 generates a UUID and saves it to the <code>DudeModel.id</code> property.</p>
<h5 id="metadata--atkeys">Metadata &amp; AtKeys <a href="#metadata--atkeys" class="anchor" aria-hidden="true">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">   <span class="kd">var</span> <span class="n">metaData</span> <span class="o">=</span> <span class="n">Metadata</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">isEncrypted</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">namespaceAware</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">ttr</span> <span class="o">=</span> <span class="o">-</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">isPublic</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="n">key</span> <span class="o">=</span> <span class="n">AtKey</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">key</span> <span class="o">=</span> <span class="n">dude</span><span class="p">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">sharedBy</span> <span class="o">=</span> <span class="n">dude</span><span class="p">.</span><span class="n">sender</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">sharedWith</span> <span class="o">=</span> <span class="n">dude</span><span class="p">.</span><span class="n">receiver</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">metaData</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">namespace</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">dude</span><span class="p">.</span><span class="n">saveTimeSent</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>Lines 4 to 8 creates the <code>MetaData</code>. This class describes the characteristics of the <code>AtKey</code> being saved on the atPlatform. eg. The <code>AtKey</code> will not be available to everyone on the atPlatform because <code>isPublic</code> is set to false. The list of <code>Metadata</code> properties can be viewed here<add metadata link here>.</p>
<p>Lines 10 to 15 creates the <code>AtKey</code>. This class acts as an unique identifier of the data being saved to the atPlatform. If the atPlatform was a table the @key would represent the row.</p>
<p>It is important to remember that the atsign that creates the data owns the data. Therefore, the sharedWith property controls who the data is being shared with and the shareBy property determine who the owner of the data is. This is not true in every case, I&rsquo;ll explain the exception next.</p>
<p>Line 17 saves the current time to the <code>DudeModel.timeSent</code> property.</p>
<h5 id="notify">Notify <a href="#notify" class="anchor" aria-hidden="true">#</a></h5>
<p>They are two ways to save data on the atPlatform. It can be saved on the sender secondary server or the receiver secondary server, We&rsquo;ll discuss the latter</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="kd">await</span> <span class="n">atClientManager</span><span class="p">.</span><span class="n">notificationService</span><span class="p">.</span><span class="n">notify</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">NotificationParams</span><span class="p">.</span><span class="n">forUpdate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">key</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nl">value:</span> <span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span><span class="n">dude</span><span class="p">.</span><span class="n">toJson</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">        <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nl">onSuccess:</span> <span class="p">(</span><span class="n">notification</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{});</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>Lines 4 to 9 saves the the method we use to save data on the receiver secondary server. The reason we want to save the dude on the receiver server is because we want the receiver to have the permission to delete the dude after listening to it.</p>
<p>The <code>NotificationParams.forUpdate()</code> method accepts an <code>Atkey</code> and a value arguments. We pass the <code>AtKey</code> we created previously in line 6 and in line 7 we pass in a string as the value.</p>
<p><code>json.encode(dude.toJson())</code> converts the <code>DudeModel</code> to a string.</p>
<h5 id="saving-profile-model-data">Saving Profile Model data <a href="#saving-profile-model-data" class="anchor" aria-hidden="true">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="n">profileMetaData</span> <span class="o">=</span> <span class="n">Metadata</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">isEncrypted</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">namespaceAware</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">isPublic</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="n">profileKey</span> <span class="o">=</span> <span class="n">AtKey</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;dude_profile_&#39;</span> <span class="o">+</span> <span class="n">dude</span><span class="p">.</span><span class="n">sender</span><span class="p">.</span><span class="n">replaceFirst</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">sharedBy</span> <span class="o">=</span> <span class="n">dude</span><span class="p">.</span><span class="n">sender</span>
</span></span><span class="line"><span class="cl">      <span class="p">..</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">profileMetaData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span></code></pre></div><p>Lines 5 to 8 creates the Profile <code>Metadata</code> and lines 10 to 13 creates the Profile <code>AtKey</code>. No <code>sharedWith</code> property was provided because the data will not be shared with any other atsign.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">AtValue</span> <span class="n">profileAtValue</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="n">profileKey</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">ProfileModel</span> <span class="n">profileModel</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">          <span class="n">ProfileModel</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">jsonDecode</span><span class="p">(</span><span class="n">profileAtValue</span><span class="p">.</span><span class="n">value</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="n">profileModel</span><span class="p">.</span><span class="n">saveId</span><span class="p">(</span><span class="n">dude</span><span class="p">.</span><span class="n">sender</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">profileModel</span><span class="p">.</span><span class="n">dudesSent</span> <span class="o">+=</span> <span class="m">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">profileModel</span><span class="p">.</span><span class="n">dudeHours</span> <span class="o">+=</span> <span class="n">dude</span><span class="p">.</span><span class="n">duration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">dude</span><span class="p">.</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="n">profileModel</span><span class="p">.</span><span class="n">longestDude</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">profileModel</span><span class="p">.</span><span class="n">saveLongestDude</span><span class="p">(</span><span class="n">dude</span><span class="p">.</span><span class="n">duration</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">put</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">profileKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="n">profileModel</span><span class="p">.</span><span class="n">toJson</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">whenComplete</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">onError</span><span class="p">((</span><span class="n">error</span><span class="p">,</span> <span class="n">stackTrace</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span></code></pre></div><p>Lines 5 to 7 retrieves the <code>ProfileModel</code> data from the remote secondary. We will discuss the <code>AtClient!.get()</code> method later in this code lab.</p>
<p>Lines 9 to 10 updated the <code>ProfileModel</code> by incrementing the previous values.</p>
<p>Lines 11 to 12 compare the current <code>dude.duration</code> with the previous <code>profileModel.longestDude</code> and saves the current <code>dude.duration</code> if it is the longest duration of the two.</p>
<p>Lines 14 to 22 saves the <code>profileModel</code> to remote secondary.</p>
<p>The code was placed in a try block because it will throw an exception if there is no <code>ProfileModel</code> in remote secondary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">putDude</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">DudeModel</span> <span class="n">dude</span><span class="p">,</span> <span class="kt">String</span> <span class="n">contactAtsign</span><span class="p">,</span> <span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Exception should be thrown the first time a profile is created for an atsign
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">put</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">profileKey</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">json</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="n">ProfileModel</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                      <span class="nl">id:</span> <span class="n">dude</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nl">dudesSent:</span> <span class="m">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nl">dudeHours:</span> <span class="n">dude</span><span class="p">.</span><span class="n">duration</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                      <span class="nl">longestDude:</span> <span class="n">dude</span><span class="p">.</span><span class="n">duration</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">.</span><span class="n">toJson</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">whenComplete</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="n">onError</span><span class="p">((</span><span class="n">error</span><span class="p">,</span> <span class="n">stackTrace</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">isCompleted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">isCompleted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>Lines 8 to 20 saves the <code>profileModel</code> to the remote secondary. This code only execute the first time a profileModel is created for an atSign.</p>
<h5 id="getting-dudes-from-remote-secondary">Getting Dudes from remote secondary <a href="#getting-dudes-from-remote-secondary" class="anchor" aria-hidden="true">#</a></h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="c1">/// Receives all dudes sent to the current atsign.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">DudeModel</span><span class="o">&gt;&gt;</span> <span class="n">getDudes</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">AtKey</span><span class="o">&gt;</span> <span class="n">receivedKeysList</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="n">key</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="n">getAtKeys</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nl">regex:</span> <span class="s1">&#39;^cached:.*@.+</span><span class="se">\$</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// sharedBy: atsign,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">receivedKeysList</span><span class="p">.</span><span class="n">addAll</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><pre><code>// @blizzard30:some_uuid.at_skeleton_app@assault30
// @blizzard30:signing_privatekey@blizzard30
</code></pre>
<p>This method retrieves the <code>DudeModel</code> thats stored on remote secondary.</p>
<p>Lines 3 instantiates an empty list that will eventually store <code>AtKeys</code>.</p>
<p>Lines 4 to 7 grabs all the <code>AtKey</code> stored in the current atSign remote secondary.</p>
<p>Line 9 add the keys to the <code>receivedKeysList</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="c1">/// Receives all dudes sent to the current atsign.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">DudeModel</span><span class="o">&gt;&gt;</span> <span class="n">getDudes</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">DudeModel</span><span class="o">&gt;</span> <span class="n">dudes</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">AtKey</span> <span class="n">key</span> <span class="k">in</span> <span class="n">receivedKeysList</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">sharedBy</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">.</span><span class="n">key</span><span class="o">!</span><span class="p">.</span><span class="n">length</span> <span class="o">==</span> <span class="m">36</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">AtValue</span> <span class="n">_keyValue</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="n">AtKey</span><span class="p">()..</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">.</span><span class="n">key</span><span class="o">!</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">dudes</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">DudeModel</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span><span class="n">jsonDecode</span><span class="p">(</span><span class="n">_keyValue</span><span class="p">.</span><span class="n">value</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="n">on</span> <span class="n">Exception</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ScaffoldMessenger</span><span class="p">(</span><span class="nl">child:</span> <span class="n">SnackBar</span><span class="p">(</span><span class="nl">content:</span> <span class="n">Text</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">toString</span><span class="p">())));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dudes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Line 4 instantiates an empty list that will eventually store the <code>DudeModel</code> extracted from remote secondary.</p>
<p>Lines 5 to 15 loops through every <code>AtKey</code> in the <code>receivedKeysList</code>.</p>
<p>line 7 filters the receivedKeysList to only select <code>AtKey</code> that was shared and where the key/id is a UUID.</p>
<p>line 8 extract the <code>AtValue</code> of the <code>AtKey</code></p>
<p>line 10 converts the value of the <code>AtValue</code> to a <code>DudeModel</code> and add it to the empty dudes list.</p>
<p>line 13 shows a SnackBar with the exception message if an error occurs.</p>
<p>Line 16 returns the <code>List</code> of <code>DudeModel</code>.</p>
<h4 id="monitor-notification">Monitor Notification <a href="#monitor-notification" class="anchor" aria-hidden="true">#</a></h4>
<p>The atPlatform has its own Notification Service that monitors being sent to the current atSign.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">monitorNotifications</span><span class="p">(</span><span class="n">BuildContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">atClientManager</span><span class="p">.</span><span class="n">notificationService</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="nl">regex:</span> <span class="s1">&#39;at_skeleton_app&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">listen</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="n">AtNotification</span> <span class="n">notification</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">String</span><span class="o">?</span> <span class="n">currentAtsign</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">            <span class="n">DudeService</span><span class="p">.</span><span class="n">getInstance</span><span class="p">().</span><span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="n">getCurrentAtSign</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">currentAtsign</span> <span class="o">==</span> <span class="n">notification</span><span class="p">.</span><span class="n">to</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="kd">await</span> <span class="n">LocalNotificationService</span><span class="p">().</span><span class="n">showNotifications</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="n">notification</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">length</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;Dude&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s1">&#39;</span><span class="si">${</span><span class="n">notification</span><span class="p">.</span><span class="n">from</span><span class="si">}</span><span class="s1"> sent you a dude&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="m">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Line 3 subscribe to data being sent over the dude app.</p>
<p>In line the listen method expects an option function. This function receives an <code>AtNotification</code> that allows us to control what data we want to listen for as show in lines 5 to 16.</p>
<p>In line 6 to 7 we get the current atsign. In line 9 we filter the notification to ensure the notification is being sent to the current atsign.</p>
<p>In lines 10 to 14 we show the user a notification that a dude was sent to them by the atSign of the sender.</p>
<h4 id="get-contacts">Get Contacts <a href="#get-contacts" class="anchor" aria-hidden="true">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="c1">/// Fetch the current atsign contacts.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AtContact</span><span class="o">&gt;?&gt;</span> <span class="n">getContactList</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">contactService</span><span class="p">.</span><span class="n">fetchContacts</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Line 3 returns a list of <code>AtContacts</code>. An AtContact is a class containing properties of other atsigns that was selected as a contact.</p>
<h4 id="get-profile">Get Profile <a href="#get-profile" class="anchor" aria-hidden="true">#</a></h4>
<p>This method retrieves the <code>ProfileModel</code> of the current atsign.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl">  <span class="c1">/// Get the profile stats for the current atsign
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="n">ProfileModel</span><span class="o">&gt;</span> <span class="n">getProfile</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">getAtKeys</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nl">regex:</span> <span class="s1">&#39;dude_profile_&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nl">sharedBy:</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="n">getCurrentAtSign</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">then</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="m">0</span><span class="p">]).</span><span class="n">then</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">ProfileModel</span><span class="p">.</span><span class="n">fromJson</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                  <span class="n">jsonDecode</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">value</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">),</span>
</span></span><span class="line"><span class="cl">              <span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Lines 3 to 7 gets a list profile models AtKeys, there only one AtKey in the list. Line 9 returns the AtValue and lines 10 to 11 returns the <code>ProfileModel</code> class.</p>
<h3 id="delete-dude">Delete Dude <a href="#delete-dude" class="anchor" aria-hidden="true">#</a></h3>
<p>This dude deletes a dude from remote secondary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dart" data-lang="dart"><span class="line"><span class="cl"> <span class="c1">/// Delete dude sent to the current atsign.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">Future</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">deleteDude</span><span class="p">(</span><span class="n">DudeModel</span> <span class="n">dude</span><span class="p">)</span> <span class="kd">async</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">List</span><span class="o">&lt;</span><span class="n">AtKey</span><span class="o">&gt;</span> <span class="n">dudeAtKey</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="n">getAtKeys</span><span class="p">(</span><span class="nl">regex:</span> <span class="n">dude</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="kt">bool</span> <span class="n">isDeleted</span> <span class="o">=</span> <span class="kd">await</span> <span class="n">atClient</span><span class="o">!</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="n">dudeAtKey</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">isDeleted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="n">on</span> <span class="n">AtClientException</span> <span class="k">catch</span> <span class="p">(</span><span class="n">atClientExcep</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">_logger</span><span class="p">.</span><span class="n">severe</span><span class="p">(</span><span class="s1">&#39;❌ AtClientException : </span><span class="si">${</span><span class="n">atClientExcep</span><span class="p">.</span><span class="n">errorMessage</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">_logger</span><span class="p">.</span><span class="n">severe</span><span class="p">(</span><span class="s1">&#39;❌ Exception : </span><span class="si">${</span><span class="n">e</span><span class="p">.</span><span class="n">toString</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></div><p>Line 4 returns a list containing a dude AtKey that corresponds with the uuid of the DudeModel. Line 5 deletes it.</p>
<p>Lines 8 to 13 logs the exception if an error occurs.</p>

        </div>
      </div>
    </div>
    








































  
  
















































<div class="codelab-controls">
  <div class="fabs">
    
    <a href="https://dev3.atsign.wtf/tutorials/at-dude/4_local_notification_services/" id="previous-step" title="Previous step">Back</a>
    
    <div class="spacer"></div>
    
    <a href="https://dev3.atsign.wtf/tutorials/at-dude/6_controller/" id="next-step" title="Next step">Next</a>
    
  </div>
</div>

  </div>
</div>

      </div>
    </div>
    
    
    <footer class="footer text-muted">
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-8 order-last order-lg-first">
        <ul class="list-inline">
          <li class="list-inline-item"></li>
        </ul>
      </div>
      <div class="col-lg-8 order-first order-lg-last text-lg-end">
        <ul class="list-inline">
          </ul>
      </div>
    </div>
  </div>
</footer>
    <script src="https://dev3.atsign.wtf/js/bootstrap.min.f93d87ed312fd94eae9a720e5988a3bd322bcdd099518866fc5668e18610cca0077fc356b3edfc727dedf5f773dab0a6d87a870e4b616595e76381163dd5a730.js" integrity="sha512-&#43;T2H7TEv2U6umnIOWYijvTIrzdCZUYhm/FZo4YYQzKAHf8NWs&#43;38cn3t9fdz2rCm2HqHDkthZZXnY4EWPdWnMA==" crossorigin="anonymous" defer></script>
  <script src="https://dev3.atsign.wtf/js/highlight.min.ab83c9c22e3502ea9a2c69dc7d30f4b944665498128154a4f5209b2d7687058cec30e0d671bba65bb00077b8bc017b214819cb115df26ae69e61aff74dd6102d.js" integrity="sha512-q4PJwi41AuqaLGncfTD0uURmVJgSgVSk9SCbLXaHBYzsMODWcbumW7AAd7i8AXshSBnLEV3yauaeYa/3TdYQLQ==" crossorigin="anonymous" defer></script>
  <script src="https://dev3.atsign.wtf/main.min.77be814f15d160fc6b19496934363bc074a55c1e7db29a528246f32bd507128551839f528fab104d30ff53a74f51ab1c87c9280d822507bd6fdc0ad4aadbe64d.js" integrity="sha512-d76BTxXRYPxrGUlpNDY7wHSlXB59sppSgkbzK9UHEoVRg59Sj6sQTTD/U6dPUasch8koDYIlB71v3ArUqtvmTQ==" crossorigin="anonymous" defer></script>
  
  </body>
</html>